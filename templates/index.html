<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SmartCare: Heart Disease Prediction</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS for quick styling (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <h2 class="card-title mb-4 text-center">SmartCare: Heart Disease Risk Predictor</h2>
                <form id="predictionForm">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="age" class="form-label">Age</label>
                            <input type="number" class="form-control" id="age" name="age" min="0" max="150" required>
                        </div>
                        <div class="col-md-4">
                            <label for="sex" class="form-label">Sex</label>
                            <select class="form-select" id="sex" name="sex" required>
                                <option value="" disabled selected>Select</option>
                                <option value="0">Female</option>
                                <option value="1">Male</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="cp" class="form-label">Chest Pain Type</label>
                            <select class="form-select" id="cp" name="cp" required>
                                <option value="" disabled selected>Select type</option>
                                <option value="0">Typical Angina</option>
                                <option value="1">Atypical Angina</option>
                                <option value="2">Non-anginal Pain</option>
                                <option value="3">Asymptomatic</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="trestbps" class="form-label">Resting Blood Pressure</label>
                            <input type="number" class="form-control" id="trestbps" name="trestbps" min="0" max="200" required>
                        </div>
                        <div class="col-md-4">
                            <label for="chol" class="form-label">Serum Cholesterol (mg/dL)</label>
                            <input type="number" class="form-control" id="chol" name="chol" min="0" max="600" required>
                        </div>
                        <div class="col-md-4">
                            <label for="thalach" class="form-label">Max Heart Rate Achieved</label>
                            <input type="number" class="form-control" id="thalach" name="thalach" min="0" max="250" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Predict Risk</button>
                </form>
                <div id="result" class="mt-4"></div>
            </div>
        </div>
        <footer class="mt-4 text-center text-muted">
            <small>SmartCare &copy; 2026</small>
        </footer>
    </div>
    <!-- Bootstrap JS bundle (with Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS for submitting form and handling result -->
    <script>
        const form = document.getElementById('predictionForm');
        const resultDiv = document.getElementById('result');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            resultDiv.innerHTML = ""; // Clear any previous result

            // Get form data
            const data = {
                age: Number(document.getElementById('age').value),
                sex: Number(document.getElementById('sex').value),
                cp: Number(document.getElementById('cp').value),
                trestbps: Number(document.getElementById('trestbps').value),
                chol: Number(document.getElementById('chol').value),
                thalach: Number(document.getElementById('thalach').value)
            };

            // Show loading
            resultDiv.innerHTML = `<div class="text-center mt-3">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2">Predicting...</p>
            </div>`;

            try {
                const res = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                const json = await res.json();
                if (res.ok && json.status === "success") {
                    resultDiv.innerHTML = `
                        <div class="alert alert-info text-center" role="alert">
                            <h4>Prediction: <span class="fw-bold">${json.prediction}</span></h4>
                            <p>Confidence: <strong>${json.confidence}%</strong></p>
                            <div class="progress" style="height: 20px;">
                              <div class="progress-bar bg-success" role="progressbar" style="width: ${json.low_risk_prob}%;" aria-valuenow="${json.low_risk_prob}" aria-valuemin="0" aria-valuemax="100">Low Risk: ${json.low_risk_prob}%</div>
                              <div class="progress-bar bg-danger" role="progressbar" style="width: ${json.high_risk_prob}%;" aria-valuenow="${json.high_risk_prob}" aria-valuemin="0" aria-valuemax="100">High Risk: ${json.high_risk_prob}%</div>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-danger" role="alert">${json.error || "Prediction failed."}</div>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<div class="alert alert-danger" role="alert">Server error. Please try again later.</div>`;
            }
        });
    </script>
</body>
</html>